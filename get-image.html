<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ambil Selfie Absensi</title>
<style>
  video, canvas, img { width: 100%; border-radius: 8px; margin-top: 10px; }
  button { margin-top: 10px; padding: 10px; width: 100%; border-radius: 8px; background: #0078ff; color: white; border: none; }
</style>
</head>
<body>
  <h3>Ambil Selfie</h3>
  <video id="camera" autoplay playsinline></video>
  <canvas id="snapshot" style="display:none;"></canvas>
  <img id="preview" alt="Preview Foto" />
  <button id="capture">Ambil Foto</button>
  <button id="usePhoto" style="display:none;">Gunakan Foto</button>

<script>
const video = document.getElementById('camera');
const canvas = document.getElementById('snapshot');
const preview = document.getElementById('preview');
const captureBtn = document.getElementById('capture');
const useBtn = document.getElementById('usePhoto');

// Aktifkan kamera
navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => video.srcObject = stream)
  .catch(err => alert("Tidak dapat mengakses kamera: " + err));

// Ambil foto
captureBtn.onclick = () => {
  const context = canvas.getContext('2d');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  context.drawImage(video, 0, 0, canvas.width, canvas.height);
  const dataUrl = canvas.toDataURL('image/png');
  preview.src = dataUrl;
  preview.style.display = 'block';
  useBtn.style.display = 'block';
  captureBtn.style.display = 'none';
};

// Kirim ke Opal (pakai parent.postMessage)
useBtn.onclick = () => {
  const dataUrl = preview.src;
  window.parent.postMessage({ type: "SELFIE_CAPTURED", image: dataUrl }, "*");
  alert("âœ… Foto dikirim ke aplikasi absensi!");
};
</script>
</body>
</html>
