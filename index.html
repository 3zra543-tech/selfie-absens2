<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Selfie Absensi</title>
</head>
<body>
  <h2>Ambil Selfie untuk Absensi</h2>
  <video id="camera" autoplay playsinline width="300"></video><br>
  <button id="capture">Ambil Foto</button>
  <canvas id="canvas" width="300" height="225" style="display:none"></canvas>

  <script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // Minta izin kamera
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => { video.srcObject = stream; })
      .catch(err => alert('Kamera tidak bisa diakses: ' + err));

    document.getElementById('capture').onclick = async () => {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageData = canvas.toDataURL('image/png');

      // kirim ke Opal Flow
      await fetch("https://opal.run/api/flow/1pYz8OyL4RyxB8nKT41xxJl6ZbpjX8HkD&mode=canvas/trigger", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          image: imageData,
          waktu: new Date().toLocaleString()
        })
      });
      alert("Foto berhasil dikirim ke Opal!");
    };
  </script>
</body>
</html>
